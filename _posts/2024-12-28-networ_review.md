---
title: network review
date: 2024-12-28 12:00:00 +/-TTTT
categories: [ network]
tags: [network,course]
---

#  network review

## overview

## app layer

## transport layer

## network layer

在网络中，**控制平面**和**数据平面**是两种不同的功能层次，它们在网络设备（如路由器、交换机等）的运作中发挥着重要作用。

### 1. **控制平面 (Control Plane)**

控制平面负责网络设备的决策和路由控制。它主要处理以下任务：
- **路由选择**：控制平面负责通过协议（如OSPF、BGP、RIP等）交换路由信息，计算最优路径，并更新路由表。
- **网络拓扑管理**：控制平面维护设备间的连接信息，并确保路由表的更新。
- **协议处理**：执行路由协议的计算和管理，包括生成路由条目、更新邻居关系等。

控制平面并不直接转发数据包，而是通过动态计算和控制信息来指导数据平面的行为。



### 2. **数据平面 (Data Plane)**

数据平面负责实际的数据包转发，它是网络设备中的执行层，主要工作是：
- **数据包转发**：根据控制平面提供的路由信息，数据平面将接收到的数据包转发到正确的输出端口。
- **包处理**：进行简单的包处理，如基于目的地址查找路由表、转发、过滤等。
- **快速转发**：数据平面主要关注快速且高效地转发数据包，通常是通过硬件（如ASIC）来完成的。

#### 路由器
* 组成
  * 输出端口
  * 输入端口
  * 交换结构
  * 路由选择处理器（控制平面）
* 转发
  * 基于目的地的转发
  * 泛化转发
* 最长前缀匹配规则

* **IP: The Internet Protocol**  
  IP（Internet Protocol）是互联网协议的基础，位于网络层，负责在不同的网络之间传输数据包。它主要通过IP地址进行通信，确保数据包从源设备传输到目标设备。IP协议有两个版本：
  
  * **IPv4**：使用32位地址空间，支持约43亿个地址。
  * **IPv6**：使用128位地址空间，提供足够的地址来支持全球所有设备。

* **Datagram Format**  
  IP 数据报（Datagram）是IP协议传输的基本单位。每个数据报由两个主要部分构成：
  
  * **头部（Header）**：包含路由信息和控制信息。常见字段有：
    * 版本（Version）
    * 头部长度（Header Length）
    * 总长度（Total Length）
    * 源IP地址（Source IP Address）
    * 目的IP地址（Destination IP Address）
    * 协议类型（Protocol）
    * TTL（Time to Live）
  
  * **数据部分（Payload）**：实际传输的应用数据。

  IPv4 和 IPv6 在数据报格式上有区别，IPv6的头部更加简化，减少了许多不必要的字段。

* **Addressing**  
  IP 地址是网络中每个设备的唯一标识符，分为两种主要类型：
  
  * **IPv4地址**：使用32位（4个字节）地址，通常表示为四个十进制数字（每个数字介于0到255之间），例如 `192.168.0.1`。
  * **IPv6地址**：使用128位（16个字节）地址，表示为8组四个十六进制数，每组通过冒号分隔，例如 `2001:0db8:85a3:0000:0000:8a2e:0370:7334`。

  IP 地址有不同的分类：
  
  * **公共地址**：可以在互联网上全球路由。
  * **私有地址**：仅在局域网中使用，不会在互联网上路由。
  * **回环地址（Loopback）**：如 `127.0.0.1`，用于本机通信。
  * **广播地址**：用于向网络中的所有设备发送消息。

* **Network Address Translation (NAT)**  
  NAT（网络地址转换）是一种技术，允许多个设备共享一个公共IP地址。它主要用于IPv4地址短缺的问题。NAT根据源地址和目标地址进行转换，使得私有IP地址能够通过公共IP地址访问互联网。
  
  NAT有几种类型：
  
  * **静态NAT**：固定映射一个内部IP地址到一个公共IP地址。
  * **动态NAT**：从公共IP池中动态选择一个公共IP地址进行转换。
  * **端口地址转换（PAT）**：多个内部设备共享一个公共IP地址，但通过不同的端口号来区分。
  
  NAT提高了安全性，但可能会影响端到端的通信，尤其是对某些应用（如点对点通信）产生影响。

* **IPv6**  
  IPv6是IPv4的继任者，旨在解决IPv4地址枯竭的问题，并提供更高效的路由和数据传输。IPv6使用128位地址，提供了更广泛的地址空间。IPv6的特点包括：
  
  * **更大的地址空间**：IPv6的地址空间可以容纳更多设备。
  * **简化的头部结构**：IPv6相比IPv4去掉了很多不必要的字段，简化了路由和数据包处理。
  * **内置安全性**：IPv6设计时就考虑了加密和身份验证，支持IPSec协议。
  * **自动配置功能**：IPv6支持设备自动获取IP地址的功能，减少了手动配置。
  
  IPv6地址使用16进制表示，分为8组，每组4个字符，如 `2001:0db8:85a3:0000:0000:8a2e:0370:7334`。

  其他IPv6的特性包括更高效的路由处理和更灵活的网络管理。

* **Generalized Forwarding**  
  **Generalized Forwarding**（泛化转发）是一个网络转发的概念，它将数据包的转发过程从传统的基于IP地址的规则扩展到可以匹配多种不同的报文特征。这意味着在数据包的转发决策中，除了传统的IP地址和端口，还可以根据其他特征进行匹配，如MAC地址、协议类型、QoS标记等。  
  该概念的目标是使网络设备能够进行更加灵活和细粒度的流量管理，而不仅仅局限于传统的路由和转发规则。

* **SDN Match+Action**  
  **SDN（Software-Defined Networking） Match+Action** 是一种在SDN环境中用于流表（Flow Table）操作的机制。在SDN架构中，控制平面通过中央控制器来管理网络设备（如交换机、路由器等），而数据平面则负责执行实际的转发决策。  
  **Match+Action**是SDN交换机或路由器如何处理流的方式：
  
  * **Match**（匹配）：表示流表中的规则，用于匹配流量的特定字段。比如，匹配IP地址、MAC地址、端口、协议类型等。匹配条件可以非常灵活，可以涉及数据包头的各种字段。
  
  * **Action**（动作）：是与匹配条件相对应的操作。当数据包符合某个“匹配”条件时，交换机会执行指定的“动作”。这些动作可以是：
    * **Forwarding**（转发）：将数据包发送到目标端口。
    * **Drop**（丢弃）：丢弃匹配的数据包。
    * **Modify**（修改）：修改数据包的某些字段（如TTL值、数据包头等）。
    * **Encapsulate**（封装）：将数据包封装进新的协议包中。
  
  在SDN中，控制器通过**Match+Action**来动态更新交换机的流表规则，灵活控制网络流量的转发行为。

* **OpenFlow: Match+Action in Action**  
  **OpenFlow**是最著名的SDN协议之一，它定义了交换机如何与控制器通信，并通过流表来管理数据包的转发。**Match+Action**在OpenFlow中的应用是核心概念之一，它决定了流量匹配和处理的方式。  
  OpenFlow中，流表包含多个条目，每个条目包含一组匹配规则和相关的动作：
  
  * **Match**（匹配）：OpenFlow流表中的每个条目包含一组匹配规则，这些规则决定了如何根据数据包的字段（如源IP地址、目标端口、协议等）来匹配数据包。匹配的字段可以非常具体，甚至可以包括TCP标志位、IP头部信息等。
  
  * **Action**（动作）：当一个数据包匹配到某个流表项时，交换机会根据对应的动作执行操作。这些操作包括转发、丢弃、修改数据包等。每个匹配项可以有多个动作，或者指定不同的操作顺序。
  
  在OpenFlow中，控制器根据网络的实际需求动态地下发匹配规则和动作，优化网络的流量管理。OpenFlow通过这种方式使网络管理变得更加灵活和可编程。

### 控制平面与数据平面的关系
- 控制平面定义网络的“规则”或“政策”，而数据平面则根据这些规则实际执行数据包的转发。
- 控制平面更新路由或转发表，数据平面通过查表进行包转发。
- 在传统网络设备中，控制平面和数据平面通常是紧密集成在一起的；但在现代的**软件定义网络 (SDN)** 中，控制平面和数据平面可以分离，控制平面通常通过中央控制器管理网络策略，而数据平面则负责执行这些策略。

## link layer
---
以太网 CSMA/CD 算法

1. 以太网接收来自网络层的数据报，并创建帧。
2. 如果以太网感知到信道状态：
   - 如果信道空闲：开始传输帧。
   - 如果信道忙碌：等待直到信道空闲，再开始传输。
3. 如果整个帧传输完成且没有发生碰撞——完成！
4. 如果在发送过程中检测到其他传输：中止当前传输，并发送干扰信号（jam signal）。
5. 在中止后，进入二进制（指数）回退：
   - 第m次碰撞后，从{0, 1, 2, …, 2^m - 1}中随机选择K。
   - 以太网等待K·512比特时间，然后返回到第2步。
   - 碰撞次数更多时，回退间隔会更长。

---
**“轮流”MAC协议**  
**信道分割MAC协议：**  
- 在高负载下高效且公平地共享信道。  
- 在低负载时效率低下：信道访问有延迟，即使只有1个活跃节点，仍会分配1/N的带宽！  

**随机访问MAC协议：**  
- 在低负载下高效：单个节点可以充分利用信道。  
- 在高负载时：碰撞开销较大。  

**“轮流”协议：**  
- 寻求两者的最佳平衡！
---
**“轮流”MAC协议**  
**轮询（Polling）：**  
- 集中式控制器“邀请”其他节点轮流传输。  
- 通常用于“简单”设备（如不具备复杂处理能力的设备）。  
- **关注点：**  
  - 轮询开销  
  - 延迟  
  - 单点故障（主设备故障会影响整个系统）  
  - 蓝牙使用轮询机制

---

**“轮流”MAC协议**  
**令牌传递（Token Passing）：**  
- 控制令牌消息按顺序从一个节点显式传递到下一个节点。  
- 持有令牌时，节点可以进行数据传输。  
- **关注点：**  
  - 令牌开销  
  - 延迟  
  - 单点故障（令牌丢失或损坏时会导致系统问题）

---
**MAC地址**  
- **32位IP地址：**  
  - 用于接口的网络层地址  
  - 用于第3层（网络层）转发  
  - 例如：128.119.40.136  

- **MAC地址（或LAN地址、物理地址、以太网地址）：**  
  - 功能：用于“本地”传输帧，从一个接口到另一个物理连接的接口（在IP地址的意义上属于同一子网）。  
  - 48位MAC地址（大多数局域网使用）通常存储在网卡的ROM中，有时也可以通过软件设置。  
  - 例如：1A-2F-BB-76-09-AD
---
**MAC地址**  
**链路层：6-45**

每个局域网（LAN）接口：  
- **具有唯一的48位MAC地址**  
- **具有本地唯一的32位IP地址**（如我们之前所见）
**MAC地址分配由IEEE管理**  
- 制造商购买MAC地址空间的一部分（以确保唯一性）。  

**类比：**  
- **MAC地址：** 类似于社会保障号（Social Security Number），唯一且固定。  
- **IP地址：** 类似于邮政地址，取决于节点所在的网络位置。  

**MAC平面地址：** 可移植性  
- 可以将接口从一个局域网（LAN）移动到另一个局域网。  
- 回想一下，**IP地址不可移植**：它依赖于节点所连接的IP子网。

---
**ARP（地址解析协议）**  
**链路层：6-47**  

**ARP表：** 每个局域网（LAN）上的IP节点（如主机、路由器）都有一个ARP表，用于存储IP地址和对应的MAC地址映射关系。

**问题：** 如何根据IP地址确定接口的MAC地址？  

例如，某些节点的IP地址和MAC地址映射可能如下：  
- 137.196.7.78 → 1A-2F-BB-76-09-AD  
- 137.196.7.14 → 58-23-D7-FA-20-B0  
- 137.196.7.88 → 0C-C4-11-6F-E3-98  
- 137.196.7.23 → 71-65-F7-2B-08-53  

**ARP工作原理：**  
- ARP协议用于解决IP地址和MAC地址之间的映射问题。  
- 当一个节点需要与局域网中的另一个节点通信时，它需要知道对方的MAC地址。  
- 节点通过发送ARP请求（ARP Request）广播在局域网上查询目标IP地址对应的MAC地址。如果目标节点收到该请求，它会响应ARP应答（ARP Reply），返回自己的MAC地址。

**ARP表中的条目包括：**  
- **IP地址**  
- **MAC地址**  
- **TTL（生存时间）**：该映射的有效时间。通常是20分钟，超过这个时间后，地址映射会被清除。  

这种机制使得节点能够在不直接使用IP地址的情况下，通过MAC地址进行通信。